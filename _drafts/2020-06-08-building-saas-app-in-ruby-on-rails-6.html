---
layout: post
title: 'Let''s build a SaaS app in Ruby on Rails 6 2020. Part 1: Introduction'
date: '2020-06-08T21:03:00.000+02:00'
author: yaro_the_slav
tags:
- tutorial
- acts_as_tenant
- ruby on rails
modified_time: '2020-07-01T18:41:03.770+02:00'
blogger_id: tag:blogger.com,1999:blog-5936476238571675194.post-1399066208481947732
blogger_orig_url: https://blog.corsego.com/2020/06/building-saas-app-in-ruby-on-rails-6.html
---

SaaS (Software as a Service) is a business model used by companies like Salesforce or Basecamp, Slack.<br />Subscription to use software<br />Types of SaaS:<br /><br /><ul><li>personal B2C (you pay for your own account monthly) - Spotify, Netflix</li><li>team B2B (per user per month / per team per month) - Basecamp, Slack, Salesforce</li></ul><br /><div>From a technical perspective this provides two completely different challenges.</div><div><br /></div><div>It's also&nbsp;</div><div><br /></div><div><br /></div>Multitenancy Company/Account/Team<br />Paywall Billing Monthly Subscriptions<br /><br /><br /><br />Comparison of multitenancy approaches:&nbsp;<a href="https://blog.arkency.com/comparison-of-approaches-to-multitenancy-in-rails-apps/">https://blog.arkency.com/comparison-of-approaches-to-multitenancy-in-rails-apps/</a><br />I would summarize it this way:<br />If you want to build automated and scalable software, go for row-based multitenancy (many low-value clients).<br />If you want to build individual enterprise software, you can consider other approaches (a few high-value clients).<br /><br />Theoretical foundation<br /><br /><a href="https://www.indiehackers.com/post/ror-saas-boilerplate-app-market-need-fb7af3d8db">Post on indiehackers</a><br /><br />Existing Ruby on Rails Software as a Service boilerplate applications:<br /><ul><li>Paid:</li><ul><li><a href="https://bullettrain.co/">https://bullettrain.co/</a>&nbsp;(too much ui)</li><li><a href="https://jumpstartrails.com/">https://jumpstartrails.com/</a>&nbsp;(too much ui )</li><li><a href="https://railskits.com/">https://railskits.com/</a>&nbsp;(focus on billing software)</li><li><a href="https://www.getsjabloon.com/">https://www.getsjabloon.com/</a>&nbsp;(application templates)</li></ul><li>Free</li><ul><li><a href="https://github.com/archonic/limestone">https://github.com/archonic/limestone</a></li><li><a href="https://github.com/bobwol/rails-saas-template">https://github.com/bobwol/rails-saas-template</a>&nbsp;(questionable)</li><li><a href="https://github.com/emersonjsouza/boilerplate-saas-rails">https://github.com/emersonjsouza/boilerplate-saas-rails</a>&nbsp;(questionable)</li><li><a href="https://github.com/excid3/jumpstart">https://github.com/excid3/jumpstart</a></li></ul></ul><div>What I don't like about Jumpstart multitenancy:<br /><br /><ul><li>Tenants (Accounts) execution</li></ul><div>What is good about jumpstart:</div><div><ul><li>Payments &amp; Subscriptions</li><li>Omniauth execution</li><li>ActionText embeds and mentions</li><li>Application Admin panel</li></ul></div><br /><br />There are a few gems for implementing multitenancy in Ruby on Rails:</div><div><ul><li><a href="https://github.com/influitive/apartment">https://github.com/influitive/apartment</a>&nbsp;- database multitenancy; somewhat maintained</li><li><a href="https://github.com/ErwinM/acts_as_tenant">https://github.com/ErwinM/acts_as_tenant</a>&nbsp;- single database &amp; schema; somewhat maintained</li><li><a href="https://github.com/jekuno/milia">https://github.com/jekuno/milia</a>&nbsp;- row-based multitenancy with single database &amp; schema; not maintained but very popular</li><li><a href="https://github.com/citusdata/activerecord-multi-tenant">https://github.com/citusdata/activerecord-multi-tenant</a>&nbsp;- row-based multitenancy with single database &amp; schema; maintained</li></ul><div>What should a single-database multitenancy gem do:</div></div><div><ul><li>give possibility to set current_tenant when needed</li><li>state which models should be tenanted and and add default_scope to them by current_tenant</li><li>restrict access to tenanted models if no tenant is set</li></ul></div><div>=&gt; In my op<br />you can clone it, or build it yourself in a day<br />minimum dependencies</div><div><br /></div><div>Existing tutorials:</div><div><ul><li><a href="https://prograils.com/courses/saas/ch/01-the-welcome-word">https://prograils.com/courses/saas/ch/01-the-welcome-word</a>&nbsp;(unfinished, 2015)</li><li><a href="https://buildasaasappinrails.com/">https://buildasaasappinrails.com/</a>&nbsp;(2019-2020)</li><li><a href="https://leanpub.com/multi-tenancy-rails-2">https://leanpub.com/multi-tenancy-rails-2</a></li><li><a href="https://web-crunch.com/posts/lets-build-with-ruby-on-rails-multitenancy-workout-tracker-app">https://web-crunch.com/posts/lets-build-with-ruby-on-rails-multitenancy-workout-tracker-app</a></li></ul></div><div>I don't want to undermine the great work Chris and Rob did, but here are some things I don't like about these SaaS boilerplates:</div><br /><ul><li>Private</li><li>Somewhat expensive</li><li>Too much UI - what if I don't need tailwind, react or stimulus?</li><li>Too many non-related addons (social login)</li><li>Learning curve - it will take quite a lot of time to configure those boilerplates to your needs.</li><li>Questionable maintenance</li></ul><b><u>In this tutorial we will try to build the ultimate basic open source Ruby on Rails SaaS boilerplate.</u></b><br /><b><u><br /></u></b><b><u>General SaaS multitenancy boilerplate requirements:</u></b><br /><br /><ul><li><b>User-Member-Tenant</b></li><li>User can log in.</li><li>User does not have to be a member of a tenant.</li><li>User can create multiple tenants.</li><li>User can switch from one tenant to another.</li><li>User can invite others to become members of a tenant.</li><li>Members are scoped under tenants.</li><li>There can be global and scoped models.</li><li>Scoped models have a tenant_id and can be accessed only if current_tenant is present.</li><li>Scoping is done on model and on controller level.</li><li><b><ul style="font-weight: 400;"></ul></b></li><li><b>Roles and Authorization</b></li><li>Authorization is done current_user.has_role?(:admin, current_tenant, current_member).</li><li>User roles are scoped by tenant (you can be admin in one tenant and editor in another tenant)</li><li>There are three basic roles: [:admin, :moderator, :viewer]</li><li>When a user creates a tenant, he becomes tenant admin.</li><li>Tenant admin can:</li><ul><li>edit tenant</li><li>invite members</li><li>delete tenant</li><li>access billing</li><li>manage user roles</li></ul><li>When a member is invited, his default role is set to moderator (can do anything except actions that are exclusive to admins)</li><li>Viewer can only see tenant records</li><li><b>Billing</b></li><li>The billing is on tenant model (tenant belongs_to Plan)</li><li>4g54</li></ul><br /><ul><li>Tenant can be set</li><ul><li>by subdomain</li><li>by url (localhost:3000/tenant_id/projects)</li></ul></ul><br />Before we continue, I assume that you already have a basic understanding of Ruby on Rails and multitenancy.<br /><br />We are going to use the&nbsp;<a href="https://github.com/ErwinM/acts_as_tenant">gem acts_as_tenant</a>.<br />https://github.com/ErwinM/acts_as_tenant/network/dependents<br />https://medium.com/@praaveen/multi-tenancy-and-sub-domain-lvh-with-rails-f364c9dc0566<br />https://qiita.com/DURIAN_JADE/items/5fccf94ba40b5d28e654<br /><br /><pre><code>  acts_as_tenant(:business, optional: true)</code></pre><br /><br />Source code:&nbsp;<a href="https://github.com/rormvp/saas">https://github.com/rormvp/saas</a><br />Live demo:&nbsp;<a href="https://railssaas.herokuapp.com/">https://railssaas.herokuapp.com/</a><br />Database schema:&nbsp;<a href="https://drive.google.com/file/d/17zEDMINc2z7j2c60w5cSdtwkRax1cMzl/view?usp=sharing">https://drive.google.com/file/d/17zEDMINc2z7j2c60w5cSdtwkRax1cMzl/view?usp=sharing</a><br /><br />Here's my current draft plan. It also explains how I envision a SaaS boilerplate:<br /><ol><li>Basics</li><ol><li>set up environment</li><li>initialize app</li><li>clean up gemfile</li><li>gem haml-rails&nbsp;<a href="https://github.com/haml/haml-rails">https://github.com/haml/haml-rails</a></li><li>install bootstrap&nbsp;<a href="https://railsbytes.com/public/templates/x9Qsqx">https://railsbytes.com/public/templates/x9Qsqx</a></li><li>controller home index</li><li>devise for User</li><li>bootstrap navbar</li><li>messages partial</li><li>gem simple_form&nbsp;<a href="https://github.com/heartcombo/simple_form">https://github.com/heartcombo/simple_form</a></li><li>user has to be logged in to access anything except home index</li></ol><li>Members and tenants</li><ol><li>scaffold tenants</li><li>scaffold members (joins users and tenants)</li><li>user - member - tenant relationships and validations</li><li>when a user creates a tenant, he becomes a member</li><li>my_tenants action - user can see a list of tenants where he is a member</li></ol><li>Invite users to be a tenant member</li><ol><li>gem devise_invitable&nbsp;<a href="https://github.com/scambra/devise_invitable">https://github.com/scambra/devise_invitable</a></li><li>invite_member button - send email invitation to join a tenant</li><li>resend_invitation button</li><li>action_mailer - email to member when he is invited to tenant</li></ol><li>gem acts_as_tenant&nbsp;<a href="https://github.com/ErwinM/acts_as_tenant">https://github.com/ErwinM/acts_as_tenant</a></li><ol><li>set current_tenant in application_controller manually</li><li>scope members by current_tenant</li><li>add tenant_id to users</li><li>button to switch tenant</li></ol><li>??</li><li>Home#index always available</li><li>Members#index available only if tenant is set***</li><li>Tenants#index available even if tenant is not set***</li><li>??</li><li>Tenant belongs_to Plan</li><li>Roles and Authorization (pundit, rolify)</li><ol><li>Upon tenant creation, the user is assigned admin role for this tenant.</li><li>Tenant admin can change roles of other tenant members. (owner/user)</li></ol></ol>Future ideas:<br /><ol><ol></ol><li>Add tests</li><li>Github/Facebook/Google oAuth</li><li>Add subdomains to tenants</li><li></li></ol><div><a href="https://github.com/pay-rails/pay">https://github.com/pay-rails/pay</a><br /><br /><br /><br /><br /></div><div><br /><br /></div>